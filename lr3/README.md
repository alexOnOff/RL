# Лабораторная работа №3. 
## Динамическое программирование 

### Обсуждение. Оценивание cтратегии (предcказание)

*1. Вывести уравнения, аналогичные (3), (4) для  qπ .*

```math
q_π(s,a) = \sum_{s^`, r}p(s^`,r|s,a)[r+γ v_π(s^`)]      (1)
```
```math
q_{k+1}(s) = \sum_{s^`, r}p(s^`,r|s,a)[r+γ v_k(s^`)] 
```

*2. Используя матрицу на рисунке выше для  vk  при  k=∞ , с помощью выведенных для  qπ  формул рассчитайте ценность действий через  vπ :  qπ(11,down),qπ(7,down),qπ(3,down) .*

Исходя из формулы (1) можно высчитать v_π(s`), но для этого необходимо знать значение γ. Найдем его:


 vπ(9) =  0,25 ( -1 - 20γ -1 - 18γ -1 - 14γ -1 + 0γ) = 0,25 (-3 - 52γ) = -1 - 13γ = -14

Тогда γ = 1

Значит ценность действия можно вычислить как

q_π(11,down) = 1 * (-1 + 1*0) = -1

q_π(7,down) = 1 * (-1 - 1\*(-14)) = -15

q_π(3,down) = 1 * (-1 - 1\*(-20)) = -21


### Обсуждение. Итерация по стратегиям

*1. Какое изменение необходимо добавить в алгоритм, чтобы он работал для случая с несколькими  π∗ ? Как следовало бы определить алгоритм итерации по стратегиям для ценностей действий?*

Тут не понимаю, надо обсуждать.

*2. Напишите программу, реализующую итерацию по стратегиям, и решите задачу об аренде машин.*

Конечная политика (по вертикали сверху вниз первый офис, количество машин от 0 до 20, по горизонтали слева вправо второй офис):
    

    0   0   0   0   0   0   -1  -2  -2  -3  -4  -4  -4  -5  -5  -5  -5  -5  -5  -5  -5
    1   1   1   1   1   0   -1  -1  -2  -3  -3  -3  -4  -4  -4  -4  -5  -5  -5  -5  -5
    2   2   2   2   1   0   0   -1  -2  -2  -2  -3  -3  -3  -3  -4  -4  -4  -4  -4  -4
    3   3   3   2   1   1   0   -1  -1  -1  -2  -2  -2  -2  -3  -3  -3  -3  -3  -3  -3
    4   4   3   2   2   1   0   0   0   -1  -1  -1  -2  -2  -2  -2  -2  -2  -2  -2  -3
    5   4   3   3   2   1   1   1   0   0   0   -1  -1  -1  -1  -1  -1  -1  -1  -2  -2
    5   4   4   3   2   2   2   1   1   1   0   0   0   0   0   0   0   0   -1  -1  -2
    5   5   4   3   3   3   2   2   2   1   1   1   1   1   1   1   1   0   0   -1  -1
    5   5   4   4   4   3   3   3   3   2   2   2   2   2   2   2   1   1   0   0   -1
    5   5   5   5   4   4   4   3   3   3   3   3   3   3   3   2   2   1   1   0   -1
    5   5   5   5   5   5   4   4   4   4   4   4   4   4   3   3   2   2   1   0   -1
    5   5   5   5   5   5   5   5   5   5   5   5   5   4   4   3   3   2   1   0   -1
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   4   3   2   1   0   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   1   0   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   2   1   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   3   2   1   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   4   3   2   1   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   1   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   1   0
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   1   1
    5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   5   4   3   2   2   2

Стоимости состояний:

    458.624 468.572 478.312 487.621 496.321 504.359 512.287 519.999 527.388 534.659 541.477 548.122 554.358 560.364 566.062 571.474 576.626 581.536 586.21 590.661 594.894
    470.571 480.311 489.619 498.32 506.359 514.285 522 529.387 536.657 543.475 550.124 556.358 562.364 568.062 573.473 578.628 583.562 588.264 592.736 596.988 601.029
    482.312 491.621 500.319 508.36 516.285 523.999 531.385 538.657 545.476 552.123 558.358 564.362 570.062 575.475 580.628 585.565 590.265 594.735 598.988 603.026 606.857
    493.62 502.321 510.361 518.283 526 533.388 540.659 547.474 554.123 560.356 566.364 572.061 577.474 582.628 587.566 592.263 596.736 600.989 605.031 608.854 612.465
    504.32 512.354 520.284 527.998 535.384 542.66 549.477 556.124 562.358 568.362 574.063 579.475 584.628 589.568 594.263 598.734 602.988 607.028 610.856 614.465 617.837
    514.352 522.283 529.996 537.383 544.659 551.476 558.124 564.357 570.362 576.062 581.475 586.63 591.566 596.263 600.735 604.989 609.026 612.854 616.463 619.837 623.012
    524.283 531.996 539.382 546.66 553.475 560.123 566.354 572.363 578.062 583.475 588.63 593.563 598.263 602.733 606.987 611.026 614.855 618.466 621.836 625.014 627.915
    533.996 541.384 548.658 555.476 562.122 568.356 574.365 580.063 585.474 590.63 595.565 600.263 604.734 608.986 613.026 616.854 620.464 623.837 627.014 629.915 632.624
    543.355 550.662 557.476 564.123 570.356 576.362 582.062 587.474 592.63 597.562 602.262 606.736 610.987 615.027 618.857 622.466 625.836 629.015 631.913 634.624 637.113
    552.3 559.474 566.122 572.356 578.364 584.063 589.476 594.629 599.563 604.262 608.733 612.988 617.028 620.857 624.465 627.838 631.014 633.915 636.624 639.114 641.403
    560.848 567.86 574.322 580.363 586.061 591.477 596.628 601.565 606.261 610.733 614.987 619.028 622.857 626.466 629.836 633.016 635.915 638.624 641.115 643.402 645.499
    569.046 575.877 582.137 587.96 593.435 598.626 603.563 608.262 612.735 616.988 621.03 624.858 628.465 631.838 635.014 637.916 640.624 643.116 645.402 647.5 649.41
    576.933 583.579 589.625 595.224 600.471 605.433 610.149 614.63 618.896 622.946 626.788 630.422 633.839 637.016 639.913 642.623 645.115 647.401 649.499 651.414 653.146
    584.536 590.99 596.826 602.197 607.218 611.958 616.454 620.724 624.779 628.629 632.271 635.706 638.929 641.916 644.624 647.113 649.401 651.498 653.413 655.144 656.726
    591.859 598.129 603.758 608.909 613.709 618.232 622.514 626.577 630.432 634.079 637.522 640.759 643.788 646.586 649.115 651.401 653.501 655.412 657.144 658.723 660.119
    598.902 604.998 610.425 615.368 619.957 624.268 628.346 632.207 635.86 639.31 642.558 645.603 648.441 651.048 653.403 655.499 657.412 659.142 660.722 662.123 663.319
    605.671 611.599 616.834 621.575 625.961 630.072 633.952 637.616 641.075 644.334 647.393 650.244 652.894 655.32 657.498 659.41 661.142 662.724 664.12 665.325 666.3
    612.171 617.938 622.987 627.539 631.729 635.644 639.328 642.803 646.077 649.148 652.019 654.69 657.152 659.402 661.409 663.141 664.722 666.122 667.322 668.301 669.008
    618.406 624.015 628.893 633.259 637.26 640.985 644.484 647.775 650.867 653.755 656.446 658.938 661.222 663.293 665.142 666.723 668.122 669.323 670.301 671.005 671.375
    624.378 629.837 634.548 638.735 642.551 646.096 649.416 652.528 655.442 658.155 660.67 662.984 665.097 667 668.686 670.122 671.323 672.3 673.008 673.379 673.379
    630.076 635.389 639.938 643.954 647.596 650.965 654.108 657.049 659.793 662.336 664.678 666.825 668.77 670.511 672.034 673.32 674.302 675.008 675.376 675.376 675.376

### Обсуждение. Итерация по ценности

*1. Почему у оптимальной политики в задаче игрока такая странная форма? В частности, для капитала  50  предлагается поставить все на одно подбрасывание, а для капитала  51  – нет. Почему такая стратегия хороша?*

Потому что это единственная положительная награда. Игрок пытаеся как можно быстрее закончить партию. Для капитала 51 кратчайшая стратегия - поставить 1, проиграть, и войти в стостояние 50.

*2. Реализуйте алгоритм итерации по ценности для задачи игрока и решите ее для  ph=[0.15;0.65]  с шагом  0.1 . Возможно, потребуется ввести два фиктивных состояния, соответствующих завершению с капиталом  0  и  100 , сопоставив им ценности  0  и  1 . Представьте свои результаты графически, как на рисунке выше. График функции ценности можно выводить один, конечный.*

Реализован. График в папке python. 
Получается, что при вероятности победы выше 50% стоимость большинства состояний резко растет и с ее увеличением движется к 1.
